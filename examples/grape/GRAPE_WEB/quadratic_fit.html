
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
      <title>Filename : quadratic_fit</title>
      <meta name="generator" content="MATLAB 7.14">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2014-03-05">
      <meta name="DC.source" content="quadratic_fit.m">
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <link rel="stylesheet" type="text/css" href="css/screen.css" media="screen" />
  </head>

<body>
    <ul id=menu>
      <li><a href="flowchart.html">Flow Chart</a>
      <li><a href="tools/tools.html">Tools</a>
      <li><a href="faq/faq.html">F. A. Q.</a>
      <li><a href="../index.html">NMR-QIP Page</a>
    </ul>
    <div class="content"><h1>FileName = quadratic_fit</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Description</a></li></ul></div><h2>Description<a name="1"></a></h2><p>After calculating conjugate gradient, the new controls, <img src="Images/quadratic_fit_eq23217.png" alt="$u_i=u_{i-1} + \epsilon \lambda_{i-1}$">. The <img src="Images/quadratic_fit_eq97780.png" alt="$\epsilon$"> is the step size we move in the direction of conjugate gradient. This <img src="Images/quadratic_fit_eq97780.png" alt="$\epsilon$"> is a constant value in original GRAPE paper by N Khaneja, but, we make it dynamic. In order to do that we calculate the controls, <img src="Images/quadratic_fit_eq84771.png" alt="$u_i$"> for the next step for three different values of <img src="Images/quadratic_fit_eq97780.png" alt="$\epsilon$">, which are <img src="Images/quadratic_fit_eq07911.png" alt="$0,\epsilon,2\epsilon$">. The fidelity using controls obtained from 3 different values of <img src="Images/quadratic_fit_eq97780.png" alt="$\epsilon$"> is calculated. Note that we do not calculate the fidelity again for <img src="Images/quadratic_fit_eq84458.png" alt="$\epsilon=0$">, since they corresponds to old controls. The 3 values of fidelity obtained as a function of <img src="Images/quadratic_fit_eq97780.png" alt="$\epsilon$"> is fitted with a quadratic fit (x axis is <img src="Images/quadratic_fit_eq97780.png" alt="$\epsilon$">). The <img src="Images/quadratic_fit_eq97780.png" alt="$\epsilon$"> for which fidelity is maximum is choosed to vary the controls. Note if the <img src="Images/quadratic_fit_eq97780.png" alt="$\epsilon$"> value for which fidelity is maximum is zero, we chose it's value to be 0.1, otherwise the loop will be an never changing infinite.</p><pre class="codeinput"><span class="keyword">function</span> multi_fac = quadratic_fit(y)

h=1;
A=[1/(2*h^2) -(1/h)^2 1/(2*h^2); -(1/h) (1/h) 0; 1 0 0];
A=A*y';
a=A(1); b=A(2);

multi=[0 1 2];

<span class="keyword">if</span> (a&gt;0 || a==0)
    [~, idx] = max(y);
    [x_max] = ind2sub(size(y),idx);
    multi_fac = multi(x_max);
<span class="keyword">else</span>
    multi_fac = -b/(2*a);
<span class="keyword">end</span>

multi_fac=min(max(0.1,multi_fac),2);
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.14<br></p></div><!--
##### SOURCE BEGIN #####
%% FileName = quadratic_fit

%% Description
% After calculating conjugate gradient, the new controls, $u_i=u_{i-1} + \epsilon \lambda_{i-1}$.
% The $\epsilon$ is the step size we move in the direction of conjugate
% gradient. This $\epsilon$ is a constant value in original GRAPE paper by
% N Khaneja, but, we make it dynamic. In order to do that we calculate the
% controls, $u_i$ for the next step for three different values of
% $\epsilon$, which are $0,\epsilon,2\epsilon$. The fidelity using controls
% obtained from 3 different values of $\epsilon$ is calculated. Note that
% we do not calculate the fidelity again for $\epsilon=0$, since they
% corresponds to old controls. The 3 values of fidelity obtained as a
% function of $\epsilon$ is fitted with a quadratic fit (x axis is
% $\epsilon$). The $\epsilon$ for which fidelity is maximum is choosed to
% vary the controls. Note if the $\epsilon$ value for which fidelity is
% maximum is zero, we chose it's value to be 0.1, otherwise the loop will
% be an never changing infinite.

function multi_fac = quadratic_fit(y)

h=1;
A=[1/(2*h^2) -(1/h)^2 1/(2*h^2); -(1/h) (1/h) 0; 1 0 0];
A=A*y';
a=A(1); b=A(2);

multi=[0 1 2];

if (a>0 || a==0)
    [~, idx] = max(y); 
    [x_max] = ind2sub(size(y),idx);
    multi_fac = multi(x_max);
else
    multi_fac = -b/(2*a);
end

multi_fac=min(max(0.1,multi_fac),2);
##### SOURCE END #####
--></body></html>