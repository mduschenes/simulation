
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
      <title>Filename : penalizecontrols</title>
      <meta name="generator" content="MATLAB 7.14">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2014-03-05">
      <meta name="DC.source" content="penalizecontrols.m">
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <link rel="stylesheet" type="text/css" href="css/screen.css" media="screen" />
  </head>

<body>
    <ul id=menu>
      <li><a href="flowchart.html">Flow Chart</a>
      <li><a href="tools/tools.html">Tools</a>
      <li><a href="faq/faq.html">F. A. Q.</a>
      <li><a href="../index.html">NMR-QIP Page</a>
    </ul>
    <div class="content"><h1>FileName : penalizecontrols</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Description</a></li></ul></div><h2>Description<a name="1"></a></h2><p>This program applies the penalty function generated in <a href="penalty.html">penalty </a>. Any amplitude above the red line is reset to the value of red line. the output u's will be the one which are penalized.</p><pre class="codeinput"><span class="keyword">function</span> u =penalizecontrols(u)
<span class="keyword">global</span> gra

<span class="keyword">for</span> n=1:gra.m/2
    Aa = sqrt(u(:,n).^2+u(:,n+length(gra.spinlist)).^2);
    [aup,bup]=find(Aa&gt;gra.uprange(:,:,n));
    cup=ones(gra.N,1);
    <span class="keyword">for</span> j=1:length(aup)
        cup(aup(j),bup(j)) = gra.uprange(aup(j),bup(j),n)/Aa(aup(j),bup(j));
    <span class="keyword">end</span>
    u(:,n)=cup.*u(:,n);
    u(:,n+length(gra.spinlist))=cup.*u(:,n+length(gra.spinlist));
<span class="keyword">end</span>
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.14<br></p></div><!--
##### SOURCE BEGIN #####
%% FileName : penalizecontrols

%% Description
% This program applies the penalty function generated in penalty [Link]
% Any amplitude above the red line is reset to the value of red line.
% the output u's will be the one which are penalized.

function u =penalizecontrols(u)
global gra

for n=1:gra.m/2
    Aa = sqrt(u(:,n).^2+u(:,n+length(gra.spinlist)).^2);
    [aup,bup]=find(Aa>gra.uprange(:,:,n));
    cup=ones(gra.N,1);
    for j=1:length(aup)
        cup(aup(j),bup(j)) = gra.uprange(aup(j),bup(j),n)/Aa(aup(j),bup(j));
    end
    u(:,n)=cup.*u(:,n);
    u(:,n+length(gra.spinlist))=cup.*u(:,n+length(gra.spinlist));
end
##### SOURCE END #####
--></body></html>