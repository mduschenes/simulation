
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
     <title>Filename : ampwr</title>
      <meta name="generator" content="MATLAB 7.14">
      <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
      <meta name="DC.date" content="2014-03-05">
      <meta name="DC.source" content="initial_u.m">
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <link rel="stylesheet" type="text/css" href="../css/screen.css" media="screen" />
  </head>
  
<body>
    <ul id=menu>
      <li><a href="../flowchart.html">Flow Chart</a>
      <li><a href="../tools/tools.html">Tools</a>
      <li><a href="../faq/faq.html">F. A. Q.</a>
      <li><a href="../../index.html">NMR-QIP Page</a>
    </ul>
    
    <div class="content"><h1>FileName : ampwr</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Description</a></li><li><a href="#2">Command</a></li><li><a href="#3">Example Output</a></li></ul></div><h2>Description<a name="1"></a></h2><p>Plots the variation of power and phase of a GRAPE pulse. Seperate plot is displayed for different channels. The top of the plot shows percentage of average and maximum power used by the GRAPE pulse along with the total maximum power allowed.</p><p>The controls ux and uy of each channel are used to calculate the power and phase.</p><p><img src="../tools/img/ampwr_eq68061.png" alt="$Amplitude = \sqrt{u_x^2 + u_y^2}$"> and <img src="../tools/img/ampwr_eq91875.png" alt="$Phase = \tan^{-1}(u_y/u_x)$"> the amplitude is then scaled with respect to the maximum power allowed calculated using puls_length. <img src="../tools/img/ampwr_eq73911.png" alt="$Max Power = 1/(4*puls\_length)$">.</p><h2>Command<a name="2"></a></h2><p><b>ampwr(GRinfo,puls_length)</b></p><p><b>GRinfo</b> : Variable in which all the information of grape pulse is stored.</p><p><b>puls_length</b> : length of the calibirated pi/2 pulse, input as a matrix for multiple nuclei. <b>Caution : input according to spinlist of the GRAPE pulse</b></p><h2>Example Output<a name="3"></a></h2><p>Shown below is an example plot.</p><p><img vspace="5" hspace="5" src="../tools/img/sample_ampwr.jpg" alt=""> </p><p>The red plot refers to power with axis ticks on the left, and the green plot refers to phase with axis ticks on the right.</p><p><b>Notice the variation at the starting and end in power</b> this is due to the penalty function which does not allow high powers at the starting and ending of a pulse.</p><pre class="codeinput"><span class="keyword">function</span>  ampwr(GRinfo,puls)
<span class="keyword">global</span> gra
gra=GRinfo;
spinlist=gra.spinlist;


amp=cell(1,length(spinlist));
scaled_amp=cell(1,length(spinlist));
average_power = zeros(1,length(spinlist));
max_power = zeros(1,length(spinlist));
phi=cell(1,length(spinlist));

a1=0:gra.del_t:gra.T; a2=gra.del_t:gra.del_t:gra.T-gra.del_t;
xplot_axis=sort([a1 a2]);



<span class="keyword">for</span> k=1:length(spinlist)
    amp{k}=sqrt((gra.u(:,k)/(2*pi)).^2 + (gra.u(:,k+length(spinlist))/(2*pi)).^2);
    scaled_amp{k}=amp{k}*100/(1/4/puls(k));
    average_power(k) = sum(scaled_amp{k})/length(scaled_amp{k});
    max_power(k) = max(scaled_amp{k});

    phi{k}=(atan2(gra.u(:,k+length(spinlist)),gra.u(:,k)));
    phi{k}=mod(phi{k},2*pi)*180/pi;

    phi{k}=reshape(repmat(phi{k},1,2)',1,2*length(gra.u))';
    scaled_amp{k}=reshape(repmat(scaled_amp{k},1,2)',1,2*length(gra.u))';

    figure
    [AX H1 H2]=plotyy(xplot_axis,scaled_amp{k},xplot_axis,phi{k});
    xlabel([<span class="string">'Time(Seconds) || Channel : '</span>,num2str(k)])
    set(get(AX(1),<span class="string">'Ylabel'</span>),<span class="string">'String'</span>,<span class="string">'Percentage Power'</span>,<span class="string">'color'</span>,[.9 0 0],<span class="string">'FontSize'</span>,12,<span class="string">'FontWeight'</span>,<span class="string">'bold'</span>)
    set(get(AX(2),<span class="string">'Ylabel'</span>),<span class="string">'String'</span>,<span class="string">'Phase(Degrees)'</span>,<span class="string">'color'</span>,[ 0 .5 0],<span class="string">'FontSize'</span>,12,<span class="string">'FontWeight'</span>,<span class="string">'bold'</span>)
    set(AX(1),<span class="string">'ycolor'</span>,[.9 0 0],<span class="string">'FontSize'</span>,12,<span class="string">'FontWeight'</span>,<span class="string">'bold'</span>)
    set(AX(2),<span class="string">'ycolor'</span>,[0 0.5 0],<span class="string">'FontSize'</span>,12,<span class="string">'FontWeight'</span>,<span class="string">'bold'</span>)
    set(H1,<span class="string">'color'</span>,[0.9 0 0],<span class="string">'LineWidth'</span>,2)
    set(H2,<span class="string">'color'</span>,[0 0.8 0],<span class="string">'LineWidth'</span>,2)
    title([<span class="string">'Avg. Power :'</span>,num2str(round(average_power(k)*100)/100),<span class="string">' %  || Max. Power : '</span>,num2str(round(max_power(k)*100)/100),<span class="keyword">...</span>
        <span class="string">' %  || Max. Allowed Power : '</span>,num2str(round(1/4/puls(k)*1e-3*100)/100),<span class="string">' KHz'</span>])
    grid <span class="string">on</span>
<span class="keyword">end</span>
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.14<br></p></div><!--
##### SOURCE BEGIN #####
%% FileName : ampwr

%% Description
% Plots the variation of power and phase of a GRAPE pulse. Seperate plot is
% displayed for different channels. The top of the plot shows percentage of
% average and maximum power used by the GRAPE pulse along with the total
% maximum power allowed.
%
% The controls ux and uy of each channel are used to calculate the power
% and phase.
%
% $Amplitude = \sqrt{u_x^2 + u_y^2}$ and $Phase = \tan^{-1}(u_y/u_x)$ the
% amplitude is then scaled with respect to the maximum power allowed
% calculated using puls_length. $Max Power = 1/(4*puls\_length)$.
%
%% Command 
% *ampwr(GRinfo,puls_length)*
%
% *GRinfo* : Variable in which all the information of grape pulse is stored.
%
% *puls_length* : length of the calibirated pi/2 pulse, input as a matrix for
% multiple nuclei. *Caution : input according to spinlist of the GRAPE pulse* 

%% Example Output
% Shown below is an example plot.
%
% <<sample_ampwr.jpg>>
%
% The red plot refers to power with axis ticks on the left, and the green
% plot refers to phase with axis ticks on the right.
%
% *Notice the variation at the starting and end in power* this is due to the penalty
% function which does not allow high powers at the starting and ending of a
% pulse.


function  ampwr(GRinfo,puls)

if nargin<1
    disp('  ')
    disp('      ampwr(GRinfo,[P1 P2])')
    disp('      Calculates Average and Maximum Percentage power and plot the power and phase')
    disp('  ')
    disp('                      P1,P2 - Time for 90 deg pulse in seconds for nuclei supplied according to spinlist')
    disp('  ')
    disp('      SIMPLEST INPUT : ampwr(GRinfo,[p1 p2])')
    disp('')
    disp('  ')
    disp('  ')
    disp('   (Hemant Katiyar, 2012)')
    return
end


global gra
gra=GRinfo; 
spinlist=gra.spinlist;


amp=cell(1,length(spinlist));
scaled_amp=cell(1,length(spinlist));
average_power = zeros(1,length(spinlist));
max_power = zeros(1,length(spinlist));
phi=cell(1,length(spinlist));

a1=0:gra.del_t:gra.T; a2=gra.del_t:gra.del_t:gra.T-gra.del_t;
xplot_axis=sort([a1 a2]);



for k=1:length(spinlist)
    amp{k}=sqrt((gra.u(:,k)/(2*pi)).^2 + (gra.u(:,k+length(spinlist))/(2*pi)).^2);
    scaled_amp{k}=amp{k}*100/(1/4/puls(k));
    average_power(k) = sum(scaled_amp{k})/length(scaled_amp{k});
    max_power(k) = max(scaled_amp{k});
    
    phi{k}=(atan2(gra.u(:,k+length(spinlist)),gra.u(:,k)));
    phi{k}=mod(phi{k},2*pi)*180/pi;
    
    phi{k}=reshape(repmat(phi{k},1,2)',1,2*length(gra.u))';
    scaled_amp{k}=reshape(repmat(scaled_amp{k},1,2)',1,2*length(gra.u))';
    
    figure
    [AX H1 H2]=plotyy(xplot_axis,scaled_amp{k},xplot_axis,phi{k});
    xlabel(['Time(Seconds) || Channel : ',num2str(k)])
    set(get(AX(1),'Ylabel'),'String','Percentage Power','color',[.9 0 0],'FontSize',12,'FontWeight','bold') 
    set(get(AX(2),'Ylabel'),'String','Phase(Degrees)','color',[ 0 .5 0],'FontSize',12,'FontWeight','bold') 
    set(AX(1),'ycolor',[.9 0 0],'FontSize',12,'FontWeight','bold')
    set(AX(2),'ycolor',[0 0.5 0],'FontSize',12,'FontWeight','bold')
    set(H1,'color',[0.9 0 0],'LineWidth',2)
    set(H2,'color',[0 0.8 0],'LineWidth',2)
    title(['Avg. Power :',num2str(round(average_power(k)*100)/100),' %  || Max. Power : ',num2str(round(max_power(k)*100)/100),...
        ' %  || Max. Allowed Power : ',num2str(round(1/4/puls(k)*1e-3*100)/100),' KHz'])
    grid on
end



##### SOURCE END #####
--></body></html>